<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

<!-- AQUÍ VA EL TÍTULO DE LA PÁGINA -->
    <title>Animaciones | Resonancia Magnética</title>

    <link href="docs/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="style.css" rel="stylesheet">
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <link href="css/mineStyle.css" rel="stylesheet">
    <script src="docs/assets/js/ie-emulation-modes-warning.js"></script>

    <script src="plotly-latest.min.js"></script>

  </head>

  <!-- EMPIEZA EL DISEÑO
    ========================================= -->
<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">MRI Index</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>

  <section class="science-text">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h2>Graficación</h2>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h2>Escala de Grises Recuperación Longitudinal</h2>
          <br>
          <p><b>Instrucciones:</b> Ingresa los valores para tres graficaciones diferentes y observa el valor que obtienen en la escala de grises.</p>
          <br>

          <div class="row">
            <div class="col-md-9">
              <div id="plot-transversal" style="width:100%;height:300px;"></div>

              <div class="row">
                <div class="col-md-3">
                  <div class="input-group">
                    <span class="input-group-addon">${M_{0}}$ =</span>
                    <input type="number" id="M0_2" class="form-control">
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="input-group">
                    <span class="input-group-addon">${T_{1}}$ =</span>
                    <input type="number" id="T1" class="form-control">
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="input-group">
                    <span class="input-group-addon">${t}$ =</span>
                    <input type="number" id="time2" class="form-control">
                  </div>
                </div>
                <div class="col-md-3">
                  <p>ID: <span id="name_1" style="font-weight: bold;text-decoration: underline;color: grey;">A</span></p>
                </div>
              </div>
              <br>
              <div class="row">
                <div class="col-md-12">
                  <button id="boton-calculador" class="calcula btn btn-block btn-large btn-primary">Calcular Recuperación Longitudinal</button>
                  <br>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <button id="genera-animacion" class="gen-anim btn btn-block btn-large btn-success hidden">Ver Contrastes</button>
                  <br>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <button id="reset-button" class="resetea btn btn-block btn-large btn-danger hidden">Vacía los datos</button>
                </div>
              </div>
                  <br>
                  <br>

            </div>
            <div class="col-md-3">
              <?xml version="1.0" encoding="iso-8859-1"?>
              <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
              <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 325.892 370.811" style="enable-background:new 0 0 325.892 370.811;" xml:space="preserve">
              <g id="Escala-grises">

                  <linearGradient id="XMLID_40_" gradientUnits="userSpaceOnUse" x1="378.2365" y1="467.317" x2="378.2365" y2="131.7322" gradientTransform="matrix(-1 0 0 -1 405.8889 486.8136)">
                  <stop  offset="0" style="stop-color:#FFFFFF"/>
                  <stop  offset="1" style="stop-color:#000000"/>
                </linearGradient>
                <rect id="XMLID_16_" x="11.52" y="19.497" style="fill:url(#XMLID_40_);stroke:#333333;" width="32.265" height="335.585"/>
                <rect id="XMLID_15_" x="11.52" y="19.497" style="fill:none;stroke:#333333;" width="32.265" height="55.931"/>
                <rect id="XMLID_14_" x="11.52" y="75.427" style="fill:none;stroke:#333333;" width="32.265" height="55.931"/>
                <rect id="XMLID_13_" x="11.52" y="131.358" style="fill:none;stroke:#333333;" width="32.265" height="55.931"/>
                <rect id="XMLID_12_" x="11.52" y="187.289" style="fill:none;stroke:#333333;" width="32.265" height="55.931"/>
                <rect id="XMLID_11_" x="11.52" y="243.22" style="fill:none;stroke:#333333;" width="32.265" height="55.931"/>
                <rect id="XMLID_10_" x="11.52" y="299.151" style="fill:none;stroke:#333333;" width="32.265" height="55.931"/>
              </g>
              <g id="Cambios_x5F_Color">
                <rect id="XMLID_9_" x="83.637" y="58.276" width="222.113" height="258.026"/>

                  <ellipse id="Circulo_A" style="fill:#FFFFFF;stroke:#333333;stroke-width:2;" cx="193.669" cy="186.765" rx="100.563" ry="118.726"/>

                  <ellipse id="Circulo_B" style="fill:#FFFFFF;stroke:#333333;stroke-width:2;" cx="243.729" cy="188.957" rx="33.669" ry="84.468"/>

                  <ellipse id="Circulo_C" style="fill:#FFFFFF;stroke:#333333;stroke-width:2;" cx="142.723" cy="166.904" rx="23.922" ry="45.338"/>
                <rect id="XMLID_8_" x="187.024" y="103.614" width="7.67" height="129.013"/>
                <rect id="XMLID_3_" x="152.557" y="251.796" style="fill:none;" width="28.177" height="27.238"/>
                <text id="Leyenda_x5F_A" transform="matrix(1 0 0 1 158.7711 270.1702)" style="font-family:'AkkoPro-Bold'; font-size:25px;">A</text>
                <rect id="XMLID_2_" x="128.635" y="156.477" style="fill:none;" width="28.177" height="27.238"/>
                <text id="Leyenda_x5F_C" transform="matrix(1 0 0 1 136.1729 174.8512)" style="font-family:'AkkoPro-Bold'; font-size:25px;">C</text>
                <rect id="XMLID_1_" x="229.641" y="181.359" style="fill:none;" width="28.177" height="27.238"/>
                <text id="Leyenda_x5F_B" transform="matrix(1 0 0 1 236.0664 199.7339)" style="font-family:'AkkoPro-Bold'; font-size:25px;">B</text>
              </g>
              </svg>

              <input type="range" id="colorRange" value="2" min="0" max="4" class="hidden range-color">
              <p id="infoPorcentaje" class="text-center">Lol</p>

            </div>
          </div>
          <br>
        </div>
      </div>
      <br>
      <br>
      <br>
    </div>
  </section>


  <!-- FOOTER -->
  <section class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <p class="p-gray">Diseñado y desarrollado por el departamento de Física de la <span style="color: white;">Facultad de Ciencias</span> de la <span style="color: white;">UNAM.</span> <br>2016. Todos los derechos reservados. </p>
        </div>
      </div>
    </div>
  </section>

<!-- JAVASCRIPT -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="docs/dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="docs/assets/js/ie10-viewport-bug-workaround.js"></script>
    <script src="js/scroll.js"></script>
	<!-- Math stuff -->
  <script type="text/x-mathjax-config">
 		MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
	</script>
	<script type="text/javascript" async
	  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
	</script>
<script>

            $(document).ready(function(){

              var counter = 0;
              var finalScales = [[],[],[]];

              LONGI = document.getElementById('plot-transversal');
              Plotly.plot( LONGI, [], {
                  margin: { t: 0 },
                xaxis: {
                  title: 'tiempo',
                  titlefont: {
                    family: 'Courier New, monospace',
                    size: 18,
                    color: '#7f7f7f'
                  }
                },
                yaxis: {
                  title: 'Mz',
                  titlefont: {
                    family: 'Courier New, monospace',
                    size: 18,
                    color: '#7f7f7f'
                  }
                } } );

              /*
              *
              * ARREGLAR ESTOOOOO
              *
              */
              $(".range-color").on('change', function(){
                var position = $(this).val();
                switch (position) {
                  case 0:
                    document.getElementById('infoPorcentaje').innerHTML = "0% del tiempo";
                    break;
                  case 1:
                    document.getElementById('infoPorcentaje').innerHTML = "25% del tiempo";
                    break;
                  case 2:
                    document.getElementById('infoPorcentaje').innerHTML = "50% del tiempo";
                    break;
                  case 3:
                    document.getElementById('infoPorcentaje').innerHTML = "75% del tiempo";
                    break;
                  case 4:
                    document.getElementById('infoPorcentaje').innerHTML = "100% del tiempo";
                    break;
                }
                var max = obtenMayor();
                var aColor = parseInt(calculaColor(max, parseFloat(finalScales[0][$(this).val()])));
                var bColor = parseInt(calculaColor(max, parseFloat(finalScales[1][$(this).val()])));
                var cColor = parseInt(calculaColor(max, parseFloat(finalScales[2][$(this).val()])));

                /*
                var aColor = parseInt(calculaColor(max, parseFloat(data[0].m0)));
                var bColor = parseInt(calculaColor(max, parseFloat(data[1].m0)));
                var cColor = parseInt(calculaColor(max, parseFloat(data[2].m0)));
                */
                var circuloA = document.getElementById("Circulo_A");
                var circuloB = document.getElementById("Circulo_B");
                var circuloC = document.getElementById("Circulo_C");

                circuloA.style.fill = "rgb(" + aColor + "," + aColor + "," + aColor + ")";
                circuloB.style.fill = "rgb(" + bColor + "," + bColor + "," + bColor + ")";
                circuloC.style.fill = "rgb(" + cColor + "," + cColor + "," + cColor + ")";
              });


              $(".gen-anim").on('click', function(){
                var data = document.getElementById('plot-transversal').data;
                var max = obtenMayor();

                // From Here
                var aColor = parseInt(calculaColor(max, parseFloat(finalScales[0][2])));
                var bColor = parseInt(calculaColor(max, parseFloat(finalScales[1][2])));
                var cColor = parseInt(calculaColor(max, parseFloat(finalScales[2][2])));

                /*
                var aColor = parseInt(calculaColor(max, parseFloat(data[0].m0)));
                var bColor = parseInt(calculaColor(max, parseFloat(data[1].m0)));
                var cColor = parseInt(calculaColor(max, parseFloat(data[2].m0)));
                */
                var circuloA = document.getElementById("Circulo_A");
                var circuloB = document.getElementById("Circulo_B");
                var circuloC = document.getElementById("Circulo_C");

                circuloA.style.fill = "rgb(" + aColor + "," + aColor + "," + aColor + ")";
                circuloB.style.fill = "rgb(" + bColor + "," + bColor + "," + bColor + ")";
                circuloC.style.fill = "rgb(" + cColor + "," + cColor + "," + cColor + ")";

                document.getElementById(("colorRange")).classList.remove("hidden");
              });




              $(".resetea").on('click', function(){
                counter = 0;
                document.getElementById("boton-calculador").classList.remove("hidden");
                document.getElementById("reset-button").classList.add('hidden');
                document.getElementById("genera-animacion").classList.add('hidden');
                document.getElementById("name_1").innerHTML = "A";
                document.getElementById('time2').removeAttribute("disabled");

                for(var i = 0; i < 3; i++){
                  Plotly.deleteTraces('plot-transversal', 0);
                }

                var circuloA = document.getElementById("Circulo_A");
                var circuloB = document.getElementById("Circulo_B");
                var circuloC = document.getElementById("Circulo_C");

                circuloA.style.fill = "rgb(255,255,255)";
                circuloB.style.fill = "rgb(255,255,255)";
                circuloC.style.fill = "rgb(255,255,255)";

                document.getElementById("M0_2").value = "";
                document.getElementById("T1").value = "";
                document.getElementById("time2").value = "";

              });

              function calculaColor(max, este){
                return (este * 255) / max;
              }

              function obtenMayor(){
                var data = document.getElementById('plot-transversal').data;
                var max = parseFloat(data[0].m0);
                for (var i = 1; i < 3; i++) {
                  if (parseFloat(data[i].m0) > max) {
                    max = parseFloat(data[i].m0);
                  }
                }
                return max;
              }



              $(".calcula").on('click', function(){

                  var mz = [];
                  var tm = [];
                  var m0_2 = document.getElementById("M0_2").value;
                  var t1 = document.getElementById("T1").value;
                  var time2 = document.getElementById("time2").value;
                  var name_1 = document.getElementById("name_1").innerHTML;
                  document.getElementById('time2').setAttribute("disabled", "true");

                  var time_step = time2/49;

                  for (var i = 0; i < 50; i++) {
                    switch (i) {
                      case 0:
                        finalScales[counter][0] = (m0_2 * (1 - Math.exp(- (time_step * i) / (t1))));
                        console.log(finalScales.length);
                        break;
                      case 12:
                        finalScales[counter][1] = (m0_2 * (1 - Math.exp(- (time_step * i) / (t1))));
                        break;
                      case 25:
                        finalScales[counter][2] = (m0_2 * (1 - Math.exp(- (time_step * i) / (t1))));
                        break;
                      case 37:
                        finalScales[counter][3] = (m0_2 * (1 - Math.exp(- (time_step * i) / (t1))));
                        break;
                      case 49:
                        finalScales[counter][4] = (m0_2 * (1 - Math.exp(- (time_step * i) / (t1))));
                        break;
                    };
                      tm.push(time_step * i);
                      mz.push(m0_2 * (1 - Math.exp(- (time_step * i) / (t1))));
                  };
                  console.log(finalScales);

                  LONGI = document.getElementById('plot-transversal');
                  Plotly.plot( LONGI, [{
                    x: tm,
                    y: mz,
                    name: name_1,
                    m0: m0_2,
                    t1: t1
                  }],
                  {
                    margin: { t: 0 },
                    xaxis: {
                      title: 'tiempo',
                      titlefont: {
                        family: 'Courier New, monospace',
                        size: 18,
                        color: '#7f7f7f'
                      }
                    },
                    yaxis: {
                      title: 'Mz',
                      titlefont: {
                        family: 'Courier New, monospace',
                        size: 18,
                        color: '#7f7f7f'
                      }
                  } } );

                  if (document.getElementById("name_1").innerHTML == "A") {
                    document.getElementById("name_1").innerHTML = "B";
                  } else if (document.getElementById("name_1").innerHTML == "B") {
                    document.getElementById("name_1").innerHTML = "C";
                  }

                counter ++;

                if (counter == 3) {
                  document.getElementById("boton-calculador").classList.add('hidden');
                  document.getElementById("reset-button").classList.remove('hidden');
                  document.getElementById("genera-animacion").classList.remove('hidden');
                }

              });
            })
          </script>

  </body>
</html>
